<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticket</title>
    <!-- [Previous CSS remains the same] -->
    <style>
        /* [Previous styles remain the same] */
    </style>
</head>
<body>
    <!-- [Previous HTML structure remains the same until the script] -->
    <script>
        const params = new URLSearchParams(window.location.search);
        
        // Set fixed content
        document.getElementById('phone').textContent = '502 2363-2036 / 502 4183-1220';
        document.getElementById('ticket').textContent = params.get('boleta');
        document.getElementById('customer').textContent = params.get('mesa');
        document.getElementById('date').textContent = params.get('fecha') || 'FECHA DE RECEPCION: 12/30/2024 16:35:49';
        
        // Function to parse price strings into numbers
        function parsePrice(priceStr) {
            if (!priceStr) return 0;
            // Remove 'Q' and any whitespace
            let price = priceStr.trim().replace('Q', '').replace(/\s+/g, '');
            // Replace comma with period for decimal
            price = price.replace(',', '.');
            return parseFloat(price) || 0;
        }

        // Handle items with line breaks
        const cantidades = (params.get('cantidades') || '').split(',');
        const servicios = (params.get('servicios') || '').split(',');
        const precios = (params.get('p_unit') || '').split(',');
        
        const itemsContainer = document.getElementById('items-container');
        let granTotal = 0;
        
        // Create a row for each item
        for (let i = 0; i < cantidades.length; i++) {
            if (cantidades[i].trim()) {  // Only create row if there's a quantity
                const cantidad = parseFloat(cantidades[i].trim());
                const precio = parsePrice(precios[i]);
                const total = cantidad * precio;
                granTotal += total;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${cantidad}</td>
                    <td>${servicios[i] ? servicios[i].trim() : ''}</td>
                    <td>${precios[i] ? precios[i].trim() : ''}</td>
                    <td>Q${total.toFixed(2)}</td>
                `;
                itemsContainer.appendChild(tr);
            }
        }

        document.getElementById('cash').textContent = params.get('efectivo');
        document.getElementById('total').textContent = params.get('total');
        document.getElementById('change').textContent = params.get('devueltas');
    </script>
</body>
</html>

